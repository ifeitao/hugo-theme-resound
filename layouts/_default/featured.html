{{ define "main" }}
<div class="page">
  <h1 class="page-title">{{ .Title }}</h1>
  <article>
  <div class="tags-expo-section">
    {{/* Use only the "featured" field */}}
    {{ $featured := where .Site.RegularPages "Params.featured" true }}
    {{ $groups := $featured.GroupByDate "2006.01" }}

    {{ range $i, $g := $groups.Reverse }}
      {{ $id := ($g.Key | urlize) }}
      <a href="#{{ $id }}" class="post-tag">#{{ $g.Key }}</a>
    {{ end }}
    <hr/>

    {{ range $i, $g := $groups.Reverse }}
      {{ $id := ($g.Key | urlize) }}
      {{ $first := index $g.Pages 0 }}
      <div class="filter-section" id="{{ $id }}">
        <h3>{{ $first.Date.Format "January" }}<span class="archive-year">{{ $first.Date.Format "2006" }}</span></h3>
        <ul>
          {{ range $g.Pages }}
            <li>
              <span class="post-date">{{ .Date.Format "2006.01.02" }}</span> - 
              <a href="{{ .RelPermalink }}">{{ .Title }}</a>
            </li>
          {{ end }}
        </ul>
      </div>
    {{ end }}
  </div>
  </article>
</div>

<script>
(function() {
  var a = document.querySelectorAll('.post-tag');
  for (var i = 0; i < a.length; i++) {
    a[i].onclick = function(e) {
      e = e || window.event;
      var target = e.target || e.srcElement;
      for (var j = 0; j < a.length; j++) {
        if (a[j] != target) {
          a[j].className = 'post-tag';
          document.getElementById(a[j].getAttribute('href').substr(1)).className = 'filter-section';
        } else {
          target.classList.toggle('select');
          document.getElementById(target.getAttribute('href').substr(1)).classList.toggle('result');
        }
      }
      e.preventDefault ? e.preventDefault() : (e.returnValue = false);
    } 
    if (window.location.hash.length) {
      try {
        document.querySelector('[href="' + decodeURI(window.location.hash) + '"]').className = 'post-tag select';
        document.getElementById(decodeURI(window.location.hash).substr(1)).className = 'filter-section result';
      } catch(err){}
    }
  }
})();
</script>
{{ end }}
